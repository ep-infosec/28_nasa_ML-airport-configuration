# Data Science pipeline



## Overview

This pipeline uses the pkl engineered data file from the data engineering pipeline and build and train/test the ML model. 

## Pipeline nodes

</br>
<!---
The list of pipeline inputs.
-->

### `init_mlflow`
|      |                    |
| ---- | ------------------ |
|Inputs | `ml_flow parameters`|,
| Description | Initiates the mlflow and set the parameters (experiment name, run, modeler name, log parameters) |

### `add_train_test`
|      |                    |
| ---- | ------------------ |
|Inputs | `de_data_set@PKL`, `parameters`|,
| Description | Calls the "test_split_fcn" specified in the parameters file, along with the "test_size" and split the data into training/test group. For example, If the data is for 10 weeks period, and the split function called is "add_train_test_random_weeks" and the test_size is 0.2, then the data is split  randomly by weeks such that 2 weeks are set for the testings and 8 weeks for training|


### `filter_configurations`
|      |                    |
| ---- | ------------------ |
|Inputs | `train/test data`, `min_airport_config_percent`|
|Description |Filters the configuration by removing the infrequent configurations in the dataset. The threshold for determining the infrequent confiquration  is set in the "min_airport_config_percent", Only configurations with frequency bigger than this threshold are kept in the data |

### `train_model`
|      |                    |
| ---- | ------------------ |
|Inputs | `filtered train/test data`, `min_airport_config_percent`,`parameters`|
|Description | This node is responsible for training the model. It calls the Recursive Multistep class (runs the pipeline generated by the "pipeline_func" in a multi-step recursive framework, i.e. executed multiple times, predicting the target value for the next step (up to the prediction_lookahead), and taking the predicted target value from the previous iteration as input ("recursive_feature")). Before training the model, a wrapper is also added to skip model and return None for invalid core features. The trained model is also logged in mlflow.

### `train_baseline`
|      |                    |
| ---- | ------------------ |
|Inputs | `active_runs`, `parameters`|
|Description | Trains a baseline model that considers that no changes in configurations|

### `predict`
|      |                    |
| ---- | ------------------ |
|Inputs | `model_pipeline`, `data`,`parameters`|
|Description | Performing the prediction and logging the predictions in Mlflow |

### `predict_baseline`
|      |                    |
| ---- | ------------------ |
|Inputs | `baseline_pipeline`, `data_predicted`,`parameters`|
|Description | Performing the prediction for the baseline model and logging the predictions in Mlflow |

### `report_performance_metrics`
|      |                    |
| ---- | ------------------ |
|Inputs | `data_predicted`,`parameters`|
|Description | Reports performance metrics for both the  baseline model and the ML model, and adds the logs to the mlflow runs|